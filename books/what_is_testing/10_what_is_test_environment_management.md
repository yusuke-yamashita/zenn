---
title: "テスト環境管理ってなんなの？"
---

# はじめに

今回は、私が頻繁に使う用語である「テスト環境管理」について語ります。

「テスト環境管理」という言葉は、ISTQBなどでは固有の言葉としておそらく定義されていません。 
これらはテストマネジメントにおける構成管理のひとつとして扱われていますが、私はあえて「テスト環境管理」という言葉を使っています。

TPI NEXT などのモデルでは、キーエリアとして「テスト環境」という名詞が使われています。 
しかし、私はこれ正確に理解するために、「テスト環境を管理する」という能動的な捉え方が必要だと考えています。

単に「環境がある」ことと、「環境が管理されている」ことは別物です。 
本記事では、私が大事にしている「テスト環境管理」という概念についてまとめます。

# テスト環境管理とは
「テスト環境管理」という言葉の定義について、私なりの解釈を述べます。
まず、「テスト環境」と「テスト環境管理」を明確に区別して考えたほうが扱いやすいと考えています。

## テスト環境 (Test Environment)
これは「モノ」です。
典型的な例では、ハードウェア、OS、ミドルウェア、ネットワーク、そしてテストデータなどです。
テストを実行するために必要となるインフラの構成要素そのものを指します。
「環境がある」「環境がない」といった文脈で語られる静的な対象です。

## テスト環境管理 (Test Environment Management)
これは「活動」です。 テスト環境を計画し、構築し、維持し、統制するというプロセス全体を指します。
「環境を管理する」という動的なアクションです。

## 作ることと管理することの違い
よくある誤解として、特定の忠実性を持ったテスト環境を「作ったら終わり」と捉えるケースがあります。
インフラを用意し、アプリをデプロイしたら「テスト環境管理は完了」とする考え方です。

しかし、私が考えるテスト環境管理の本質は、作ることだけではありません。
必要性を計画し、維持し、コントロールすることにあります。

例えば長期間維持するテスト環境の場合、複数回利用するにつれ、テストデータは汚れ、設定は変更され、環境の状態は刻一刻と変化します。
また、複数のチームが同時にテストを行えば、リソースの競合も発生します。

これらは意図したものであればよいですが、意図せず発生したテスト環境の汚れはテスト実行の妨げになることがよくあります。

テスト環境は作って満足して放置せず、テストの目的に合わせて常に「意図した状態」に保ち続けることが大事です。
単にテスト実行のためのインフラを提供するだけでなく、そのインフラを能動的にコントロールし続けることこそが、「テスト環境管理」だと私は定義しています。

# テスト環境管理の具体的な活動

では、具体的に「管理する」とは何をすることなのでしょうか。
私は大きく分けて3つの論点があると考えています。

## 忠実性と代表性のコントロール

テスト環境についてよく議論されるのが、「本番環境と全く同じであるべきか」という点です。
いわゆる「本番相当」という言葉です。

今まで、多くのプロジェクトでは「本番と同じであること」が良しとされてきました。
私は必ずしもそれが正解とは限らないと考えています。 

テスト環境管理において重要なのは、テストの目的に応じて環境の**「忠実性」と「代表性」**をコントロールすることです。
今まで私はこの二つを同じものだと定義してきましたが、管理上は分けて考えると判断がしやすくなると気づきました。

- 忠実性: ハードウェア、OS、ネットワーク構成など静的な状態や構成する箱が本番に近いか。
- 代表性: 投入されているデータやトラフィックパターンなど、動的な状態や環境の中身が本番の利用状況を表しているか。

例えば、単純な機能テストであれば、本番環境と同じ、高い忠実性は不要かもしれません。
一方で、本番で発生しうる多様なパターンのデータ、つまり高い代表性が必要になる場合もあります。

むろん、性能効率性テストであれば、忠実性・代表性両方が重要になる場合もあります。
信頼性においてはむしろ本番環境での「シフトライト」を行うこともあります。

思考停止で「完全な本番コピー」を目指すのはあまりいい方法ではないと思います。
コストとリスクを天秤にかけ、「このテストにはどの程度の忠実性が必要で、どのような代表性があればよいか」というバランスを設計することが大切だと考えています。

## 「正しい状態」の維持

テスト環境は構築して終わりではなく、時間の経過とともに状態が変化します。 
私はこれを「環境の腐敗」と呼ぶことがあります。
テスト環境管理において、「環境が腐敗していないか」を管理することは、テスト実行の信頼性を担保する上で極めて重要です。

### 環境はなぜ腐敗するのか
テスト環境を長期間維持し、繰り返し利用する場合、環境は必ず腐敗していきます。

- データの汚れ: テスト実行によりデータベースが更新され、整合性が崩れる。あるいは不要なデータが蓄積し、ストレージを圧迫する。
- 構成の乖離: アプリケーションのデプロイ、パッチ適用、設定変更が繰り返されることで、当初定義していた「あるべき構成」から乖離していく。

これらが「テストの目的として意図したもの（例：データが溜まった状態での性能テスト）」であれば問題ありません。 
しかし、「意図せず発生した環境の腐敗」は、テスト実行の阻害要因となることがあります。

### 「バグ」か「環境」か
環境が適切に管理されていない場合、テストが失敗した際に問題の切り分けが困難になります。
「ソフトウェアのバグ」なのか、それとも「データの汚れや設定ミスによる環境の問題」なのか、ときにこの調査に多大な時間を要することもあります。
これは開発組織全体責務でもありますが、この状況に問題意識を持たないのはテストエンジニアの怠慢だと思うことさえあります。

### モニタリングとコントロール
したがって、テスト環境管理では、漫然と環境を維持するのではなく、能動的なモニタリングとコントロールが必要です。

具体的には以下のサイクルを回す必要があります。

- 定義: 「なにが正しい状態か」を定義する。（バージョン、データセット、設定値など）
- モニタリング: 「いまは正しい状態か」を監視する。（ヘルスチェック、データの整合性チェック）
- コントロール: 必要に応じて、正しい状態へ復旧させる。（データのクリーニング、スナップショットからのリストア、あるいは環境の再構築）

環境の状態を常に把握し、テスト実行者が「この環境は正しい」と確信してテストを行える状態を維持することが環境管理において大切だと思っています。

## リソースとコストの管理

リソースとコストの管理も切実な問題です。 
特にハードウェアに制約のある組み込み開発ではテスト環境の準備に数億単位のコストがかかることがあります。
また、従量課金のクラウドサービスを利用している場合でも、テスト環境の維持には予測が難しいコストとなることがあります。

### リソースとデリバリー
テスト環境の準備に避けるリソースが有限である以上、複数のチームやプロジェクトで利用が重なれば、当然競合が発生します。
「テストしたいのに環境が空いていない」という待ち時間は、開発のリードタイムを遅らせる無駄な時間です。

経験上、こういった状況は組み込み系のプロダクトで起こりやすいです。
特に忠実性の高い"施設"レベルのテスト環境だと、とても難しい問題でした。

製造業の現場では、こういった問題に対する管理は比較的高度なものでした。
一方で、Webなどの柔軟性のあるプロダクトでは、「仕方ない」と割り切ってしまい、管理が十分でない場合もあります。

私は、「仕方ない」と放置するのではなく、テスト計画の段階から環境の利用計画を立て、調整を行うことが必要だと思います。 
必要なタイミングで、必要な環境が確実に利用できる状態を作っておくことは、テスト環境管理における納期管理そのものであり、どんなプロダクトでも重要だと考えています。

### 経済的合理性の追求
また、環境の維持にはコストがかかります。
技術的にはいくらでも環境を複製できる時代になったとしても、多くのプロジェクトでは予算は無限ではありません。

ここでも「経済的合理性」は考えておくべきだと考えています。
そのテスト環境を維持するコストは、そこで得られる安心やスケジュールの柔軟性、または得られる品質保証（情報）と釣り合っているでしょうか？

よくあるのが、一度作ったものの使われなくなった「ゾンビ環境」が放置されているケースや、オーバースペックな環境を漫然と使い続けているケースです。 
これらは組織のリソースを食いつぶす無駄であり、テスト環境管理の怠慢だと考えています。

### 「捨てる」という管理
環境を作ることは重要です。
同じように、環境を「捨てる」「停止する」判断も重要になります。

不要になった環境を即座に破棄し、コストを最適化すること。 
これもまた、能動的な管理活動の一部だと考えています。

# インフラもコードである時代でも重要な「テスト環境のテスト」
「テスト環境そのもののテスト」は、IaCが登場する以前から存在していました。 

OSのバージョンは合っているか、ミドルウェアの設定値は正しいか、ネットワークは疎通しているか。
これらをチェックリストなどで確認し、テスト開始判断を行うことは、昔から行われてきた品質保証活動の一部です。

IaCが当たり前になった現代においても、この活動が必要な場合があります。
インフラがコードになり、変更が容易になりました。
だからこそ、アプリのコードと同じように**「環境にバグが混入する」**リスクを強く意識する必要があると考えています。

間違った設定がコード化されれば、間違った環境が大量生産されるからです。

だからこそ、これからのテスト環境管理では、これまで手動や目視で行っていた確認を含め、 **「テスト環境のテスト」** をより体系的に組み込む必要があると考えています。

テスト環境が正しいことを保証するのは、いつの時代もテストの信頼性を担保する上で重要です。 
これもまた、能動的なテスト環境管理の重要な活動の一つだと認識しています。

# おわりに

テスト環境管理は、テストの信頼性を支える重要な活動だと私は考えています。

この記事を読んで、「私はどうだろう？」と思った方へのタフクエスチョンがあります。
**「あなたは、自分たちの使っているテスト環境のことをどれくらい知っていますか？」**

構成は？データの鮮度は？コストはどれくらいかかっていますか？
何か想定と違うものはありますでしょうか。それは意図されたものなのでしょうか。

現状を正しく把握することから、管理は始まります。
私も頑張ります。